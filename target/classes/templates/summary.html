<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<header th:replace="fragments/header" />

<body>

	<!--================Breadcrumb Area =================-->
	<section class="breadcrumb_area">
		<div class="overlay bg-parallax" data-stellar-ratio="0.8"
			data-stellar-vertical-offset="0" data-background=""></div>
		<div class="container">
			<div class="page-cover text-center">
				<h2 class="page-cover-tittle f_48">Reservation</h2>
				<ol class="breadcrumb">
					<li><a href="index.html">Home</a></li>
					<li class="active">Reservation</li>
				</ol>
			</div>
		</div>
	</section>
	<!--================Breadcrumb Area =================-->

	<!--================ Testimonial Area  =================-->
	<section class="testimonial_area section_gap">
		<div class="container">
			<div class="section_title text-center">
				<h2 class="title_color">[[${room.roomType}]]</h2>
				<p>We all live in an age that belongs to the young at heart.
					Life that is becoming extremely fast,</p>
			</div>
			<div class="testimonial_slider owl-carousel">
				<div class="media testimonial_item">
					<img th:src="@{/assets/image/room/01.jpg}" style="width: 470px;">
				</div>
				<div class="media testimonial_item">
					<img th:src="@{/assets/image/room/02.jpg}" style="width: 470px;">
				</div>
				<div class="media testimonial_item">
					<img th:src="@{/assets/image/room/03.jpg}" style="width: 470px;">
				</div>
				<div class="media testimonial_item">
					<img th:src="@{/assets/image/room/04.jpg}" style="width: 470px;">
				</div>
			</div>
		</div>
	</section>
	<!--================ Testimonial Area  =================-->

	<!-- Start Align Area -->
	<div class="whole-wrap">
		<div class="container">
			<form th:action="@{|/processPayment/${invoice.invoiceId}|}"
				class="formPayment" method="POST" th:object="${invoice}">
				<div class="section-top-border">
					<h3 class="mb-30 title_color">Summary</h3>
					<div class="row" style="margin-bottom: 20px;">
						<div class="col-md-6">
							<div class="mt-10">
								<input type="text" name="customer_name"
									placeholder="Customer Name" onfocus="this.placeholder = ''"
									onblur="this.placeholder = 'Customer Name'" required
									class="single-input" th:field="*{customerName}"
									disabled="disabled"> <span style="font-size: 12px;">Fill
									in the customer's name according to the ID card / passport /
									driver's license (without punctuation / title)</span>
							</div>
							<div class="mt-10">
								<input type="text" name="phone_number"
									placeholder="Phone Number" onfocus="this.placeholder = ''"
									onblur="this.placeholder = 'Phone Number'" required
									class="single-input" th:field="*{customerPhoneNumber}"
									disabled="disabled"> <span style="font-size: 12px;">Example:
									+62812345678, for Country Code (+62) and No. Mobile 0812345678</span>
							</div>
						</div>
						<div class="col-md-6">
							<div class="mt-10">
								<input type="email" name="EMAIL" placeholder="Email address"
									onfocus="this.placeholder = ''"
									onblur="this.placeholder = 'Email address'" required
									class="single-input" th:field="*{customerEmail}"
									disabled="disabled"> <span style="font-size: 12px;">Example:
									email@example.com</span>
							</div>
						</div>
					</div>
					<div class="row" style="margin-bottom: 20px;">
						<div class="col-md-6">
							<div class="form-group">
								<div class='input-group date' id='datetimepicker1'>
									<input type='text' class="form-control"
										placeholder="Check In Date" th:field="*{checkinDate}"
										disabled="disabled" required /> <span
										class="input-group-addon"> <i class="fa fa-calendar"
										aria-hidden="true"></i>
									</span>
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="form-group">
								<div class='input-group date' id='datetimepicker1'>
									<input type='text' class="form-control"
										placeholder="Check Out Date" th:field="*{checkoutDate}"
										disabled="disabled" required /> <span
										class="input-group-addon"> <i class="fa fa-calendar"
										aria-hidden="true"></i>
									</span>
								</div>
							</div>
						</div>
					</div>
					<div class="row" style="margin-bottom: 20px;">
						<div class="col-md-4">
							<div class="input-group">
								<select class="wide" th:field="*{numberOfAdult}"
									disabled="disabled" required>
									<option data-display="Adult" value="">Adult</option>
									<option value="1">1</option>
									<option value="2">2</option>
									<option value="3">3</option>
								</select>
							</div>
						</div>
						<div class="col-md-4">
							<div class="input-group">
								<select class="wide" th:field="*{numberOfChild}"
									disabled="disabled" required>
									<option data-display="Child" value="">Child</option>
									<option value="0">0</option>
									<option value="1">1</option>
									<option value="2">2</option>
								</select>
							</div>
						</div>
						<div class="col-md-4">
							<div class="input-group">
								<select class="wide" th:field="*{numberOfRoom}"
									disabled="disabled" required>
									<option data-display="Room" value="">Number of Rooms</option>
									<option value="1">1</option>
									<option value="2">2</option>
									<option value="3">3</option>
								</select>
							</div>
						</div>
					</div>
				</div>
				<div class="section-top-border">
					<h3 class="mb-30 title_color">Pricing Details</h3>
					<h5 class="mb-30 title_color">
						Invoice Number : <span class="showTransactionId">[[${invoice.invoiceId}]]</span>
					</h5>
					<h5 class="mb-30 title_color">Number of Rooms :
						[[${invoice.numberOfRoom}]]</h5>
					<div class="progress-table-wrap">
						<div class="progress-table">
							<div class="table-head">
								<div class="serial" style="width: 1000px;">Room Price</div>
								<div class="serial" style="width: 50px;">:</div>
								<div class="country" style="width: 20px; text-align: right;">$</div>
								<div class="country" style="width: 30px; text-align: right;">[[${invoice.roomPriceDollar}]]</div>
								<div class="visit" style="width: 20px; text-align: right;">/</div>
								<div class="visit" style="width: 30px; text-align: right;">
									<img th:src="@{/assets/image/ether.png}"
										style="width: 20px; height: 20px;">
								</div>
								<div class="percentage showPrice" style="width: 40px;">[[${invoice.roomPriceEther}]]</div>
							</div>
							<div class="table-head">
								<div class="serial" style="width: 1000px;">Deposit</div>
								<div class="serial" style="width: 50px;">:</div>
								<div class="country" style="width: 20px; text-align: right;">$</div>
								<div class="country" style="width: 30px; text-align: right;">[[${invoice.depositDollar}]]</div>
								<div class="visit" style="width: 20px; text-align: right;">/</div>
								<div class="visit" style="width: 30px; text-align: right;">
									<img th:src="@{/assets/image/ether.png}"
										style="width: 20px; height: 20px;">
								</div>
								<div class="percentage showDeposit" style="width: 40px;">[[${invoice.depositEther}]]</div>
							</div>
							<div class="table-head">
								<div class="serial" style="width: 1000px;">
									<b>Total</b>
								</div>
								<div class="serial" style="width: 50px;">
									<b>:</b>
								</div>
								<div class="country" style="width: 20px; text-align: right;">
									<b>$</b>
								</div>
								<div class="country" style="width: 30px; text-align: right;">
									<b>[[${totalDollar}]]</b>
								</div>
								<div class="visit" style="width: 20px; text-align: right;">
									<b>/</b>
								</div>
								<div class="visit" style="width: 30px; text-align: right;">
									<img th:src="@{/assets/image/ether.png}"
										style="width: 20px; height: 20px;">
								</div>
								<div class="percentage" style="width: 40px;">
									<b><span class="showTotal">[[${totalEther}]]</span></b>
								</div>
							</div>

						</div>
					</div>
				</div>
				<div class="section-top-border">
					<h3 class="mb-30 title_color">Payment Method</h3>
					<div class="row">
						<div class="col-md-4">
							<div class="mt-10">
								<div class="single-element-widget">
									<div class="switch-wrap d-flex">
										<div class="form-check">
											<input type="radio" name="paymentMethod"
												th:field="*{paymentMethod}" id="flexRadioDefault1"
												value="CREDITCARD" disabled="disabled"> <label
												class="form-check-label" for="flexRadioDefault1"><h4>
													<p>
														Credit Card <img th:src="@{/assets/image/visa.png}"
															style="width: 70px; height: 25px;"> <img
															th:src="@{/assets/image/mastercard.png}"
															style="width: 40px; height: 25px;">
													</p>
												</h4></label>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-4">
							<div class="mt-10">
								<div class="single-element-widget">
									<div class="switch-wrap d-flex">
										<div class="form-check">
											<input type="radio" name="paymentMethod"
												th:field="*{paymentMethod}" id="flexRadioDefault2"
												value="ETHEREUM" checked disabled="disabled"> <label
												class="form-check-label" for="flexRadioDefault2"><h4>
													<p>
														Ethereum <img th:src="@{/assets/image/ether.png}"
															style="width: 25px; height: 25px;">
													</p>
												</h4></label>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<input class="contract form-control" type='text' name="contractAddress" th:value="${contractAddress}" hidden="true">
				<input class="receipt form-control" type='text' name="receipt" hidden="true">
			</form>
			<div class="section-top-border">
				<div class="row">
					<div class="col-lg-12">
						<div class="button-group-area mt-10" style="text-align: right;">
							<button
								class="genric-btn primary-border circle arrow e-large buttonPayment">
								Pay<span class="lnr lnr-arrow-right"></span>
							</button>
						</div>
					</div>
				</div>
			</div>
			<!-- <div class="section-top-border">
				<button
					class="genric-btn info-border circle arrow enableEthereumButton">
					Connect to Metamask<span class="lnr lnr-arrow-right"></span>
				</button>
				<h2 style="margin-top: 25px;">
					Account: <span class="showAccount"></span><br> Balance: <span
						class="showBalance"></span> <img
						th:src="@{/assets/image/ether.png}"
						style="width: 25px; height: 25px;"> Ether
				</h2>

				<form th:action="@{|/processPayment/${invoice.invoiceId}|}"
					th:object="${invoice}" method="POST">

					<div class="row" style="margin-bottom: 20px;">
						<div class="col-md-3">
							<div class="mt-10">
								<h3>
									<span><b>Enter Amount :</b></span>
								</h3>
							</div>
						</div>
						<div class="col-md-3">
							<div class="mt-10">
								<input class="ether form-control" type='text' name="ether"
									required="required">
							</div>
						</div>
					</div>
					<input class="address form-control" type='text' name="address"
						required="required" hidden="true">
					<div class="button-group-area mt-10" style="text-align: right;">
						<button
							class="genric-btn primary-border circle arrow e-large payButton"
							disabled="disabled">
							Pay<span class="lnr lnr-arrow-right"></span>
						</button>
					</div>
				</form>
			</div> -->
		</div>
	</div>
	<!-- End Align Area -->
</body>

<footer th:replace="fragments/footer" />

<script type="text/javascript">
	
	const formPayment = document.querySelector('.formPayment');
	const buttonPayment = document.querySelector('.buttonPayment');
	const transactionId = document.querySelector('.showTransactionId').innerHTML;
	const price = document.querySelector('.showPrice').innerHTML;
	const deposit = document.querySelector('.showDeposit').innerHTML;
	const total = document.querySelector('.showTotal').innerHTML;
	const CONTRACT_ADDRESS = document.querySelector('.contract').value;
	const receipt = document.querySelector('.receipt');
	
	buttonPayment.addEventListener('click', () => {
		processPayment();
	});
	
	async function processPayment() {
		const provider = new ethers.providers.Web3Provider(window.ethereum);
		const account = await provider.send("eth_requestAccounts", []);
		const signer = provider.getSigner();
		const contract = new ethers.Contract(CONTRACT_ADDRESS, contractAbi, signer);
		
		const response = await contract.createTransaction(transactionId, ethers.utils.parseEther(price), ethers.utils.parseEther(deposit), {value: ethers.utils.parseEther(total)})
		.then(tx => {
			receipt.value = JSON.stringify(tx);
			setTimeout(() => formPayment.submit(), 3000);
		})
		.catch(e => {
		     if (e.code === 4001){
		         alert(e.message);
		     } else {
		    	 alert(e.reason);
		     } 
		});
	}
	
</script>

<!-- <script type="text/javascript">

		const ethereumButton = document.querySelector('.enableEthereumButton');
		const payButton = document.querySelector('.payButton');
		const showAccount = document.querySelector('.showAccount');
		const showBalance = document.querySelector('.showBalance');
		const address = document.querySelector('.address');
		
		ethereumButton.addEventListener('click', () => {
		  getAccount();
		});
		
		async function getAccount() {
		  const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
		  const account = accounts[0];
		  showAccount.innerHTML = account;
		  address.value = account;
		  
		  	$.ajax({
				url : "/balance/" + account,
				type : "GET",
				error : function() {
					$('.showBalance').html(
						'<p>An error has occurred</p>');
				},
				success : function(data) {
					showBalance.innerHTML = data;
					payButton.disabled = false;
				}
			});
		}
		
</script> -->

</html>